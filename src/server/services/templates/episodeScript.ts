import type { LLMTemplate } from '../../../common/llm/types';

export const episodeScriptTemplate: LLMTemplate = {
  id: '单集剧本_generation',
  name: 'Episode Script Generation',
  promptTemplate: `你是专业的中国短剧编剧，专门为抖音、快手、小红书等平台创作2分钟短剧剧本。

## 参考资料

以下是生成剧本的参考资料：

**主要内容来源：**
- **[jsondoc] 分集大纲** - 这是你创作剧本的主要依据，包含开场钩子、主要剧情、情感高潮和结尾悬念
- **[jsondoc] 剧本设定** - 提供角色设定、世界观、商业定位等框架信息
- **[jsondoc] 前集剧本** - 提供前面已生成的剧本，确保连贯性和一致性（如果存在）

%%jsondocs%%

## 创作要求

  ### 2分钟短剧特色
  - **极限开场（0-5秒）**：必须用强钩子抓停滑屏（反常画面/危险动作/金句/反转信息差）。
  - **可视事件密度**：每10秒至少出现1个“可被剪出来”的可视事件（动作/道具/情绪爆点/信息揭示）。
  - **竖屏叙事优化**：前景-中景-背景三层构图；人物与道具靠近镜头，避免远景空镜头；调度简短。
  - **对白节能**：台词短促有力，建议单句≤14字；避免多轮无效问答；用动作与道具替代解释性台词。
  - **爽点与悬念并行**：每30-40秒一个爽点（反压迫/反套路/情绪宣泄）+ 一个未解问题。
  - **去脸谱化**：职业技能、情绪反应与个人经历挂钩，避免“傻白甜/工具人反派/空洞霸总”等刻板设定。
  - **平台传播性**：每段落给出“可做标题/封面物件/弹幕话题”的抓手（高能台词、对峙瞬间、反转截图）。

  ### 剧本格式要求
  - 标准剧本格式；使用镜头标记：△特写/慢镜头/画外音/插入/交叉剪辑 等，便于剪辑。
  - 场景数建议1-3个，转场清晰可拍；避免复杂群演/特效/大场面依赖。
  - 对白自然，符合人物职业语言；单句建议≤14字，连续独白≤2句；多用潜台词与动作替代说明文。
  - 动作指导明确落地：走位、触点（手、目光、道具）、情绪强度、物件细节（痕迹/序列/刻字）。
  - 竖屏BGM/SFX标签可选：[SFX: 心电监护鸣]、[BGM: 低压电子]，用于剪辑参考。
  - 字数目标：单集成片字数约700-900（中文字符），过短补细节，过长压台词与景别。

  ### 结构要求（精细时间轴）
  1. **0-5秒 开场钩子**：异常画面/危险动作/金句定调；交代一个未解问题。
  2. **5-15秒 设局**：抛出目标与阻力；道具/环境信息露出（刻痕、节律、视线偏移）。
  3. **15-45秒 推进**：以动作驱动信息（换景/逼近/交换/试探）；每≥15秒补一次视觉新信息。
  4. **45-75秒 冲突升级**：误导-纠正-反击；情绪或立场产生明显位移（靠近/抽离/触点）。
  5. **75-95秒 反转1**：信息差揭示（协议/点阵/监控/习惯性动作）；立刻用动作验证。
  6. **95-110秒 情感峰值**：短促台词+肢体触点（托、拽、挡、递）；给出可传播金句/姿态。
  7. **110-120秒 结尾悬念**：短信/门铃/远景监视/未接电话等“外力”打断，抛出下一集问题与地点。

  ### 连续性与背景交代要求（严格）
  - 必须与分集大纲完全一致，不得新增世界观/人物关系/关键事件设定。仅可细化已有设定。
  - 在不牺牲节奏的前提下，完成以下最低背景锚点（任一锚点缺失视为不合格）：
    1) 时间与地点锚点：具体到日/夜与空间类型（医院天台/银行外/老街咖啡馆）。
    2) 人物三角关系锚点：三位核心人物的当前关系与最初连接方式（当年事件/职业关联/家族关系）。
    3) 起因锚点：本集冲突与总剧情主线的因果连接（旧案/监管协议/戒指点阵）。
  - 至少使用一次倒叙、插叙或闪回，并用标签标记：回忆/插叙/闪回，以便剪辑与校验。
  - 背景交代应通过“动作+道具+微表情”驱动，少用直白叙述；优先使用可视化证据（照片、协议、伤疤、刻字、节律）。

  ### 背景交代策略库（按需选择1-2种）
  - 物件触发：照片、协议、戒指、钥匙引出当年片段（回忆）。
  - 场地触发：老地点（咖啡馆/码头/工厂）引发插叙，快速给出缘起与人物连接。
  - 对峙触发：台词中嵌入职业特征识读（呼吸/瞳孔/脉搏）带出当年因果。
  - 第三人证词：闺蜜/战友/目击者一段“证词式”短台词，配合道具证明，避免纯讲述。

  ### 覆盖检查清单（创作时内化，不输出到成片）
  - 是否在120秒内出现时间与地点？
  - 三位核心人物是否全部具名且与大纲中的关系一致？
  - 是否明确点出“他们为何此刻在此相遇/对峙”的因果？
  - 是否使用了倒叙/插叙/闪回并完成一次有效信息补全？
  - 是否所有新信息均可在大纲或设定文档中找到依据？

## 格式示例

以下是标准的剧本输出格式示例：

### 示例1：开场钩子型（紧张悬疑）
输出JSON格式：
{
  "episodeNumber": 1,
  "title": "银行劫案真相",
    "scriptContent": "第1集\\n\\n1-1场景：银行外 日 外\\n\\n出场人物：王野（32岁，谈判专家）、林琛（35岁，特警队长）、警员若干\\n\\n△特写：银行玻璃内反光摇曳，劫匪右手顶住人质太阳穴，枪口微颤；女职员睫毛抖动，泪痕在冷光下泛白。\\n\\n劫匪（扩音器，声线发颤）：我要见谈判专家！现在！\\n\\n△警戒线后，红蓝警灯交替扫过。王野推开车门，扯松藏蓝领带，指骨在阳光下泛冷。\\n\\n王野：啧，又是临时工水平。\\n\\n林琛（按住他肩）：这次别玩你那套，直接击毙！\\n\\n王野（眯眼看向监控）：等等。人质瞳孔持续缩小，劫匪在撒谎。\\n\\n△王野抬手示意降噪，低声：他在拖延。钟表、火药味、手汗……有不对。\\n\\n1-2场景：监控车 日 内\\n\\n出场人物：王野、林琛、技术员\\n\\n△热成像画面抖动。技术员放大劫匪面部，鼻翼扩张频率与屏幕右下角计时条错位。\\n\\n王野：鼻翼扩张是闻到火药，不是紧张。手汗却在降低——说明他没准备真杀人。\\n\\n林琛（沉声）：你的结论是？\\n\\n王野：炸弹是假，枪可能也是。给我十五秒对话窗口。\\n\\n△林琛抿唇点头，手指在对讲机上点两下。\\n\\n对讲机声（沙沙）：话筒开通。\\n\\n王野（对外放）：兄弟，虎口都磨出血了。缺钱可以谈条件。我卡里有八十万。\\n\\n△监控画面中，劫匪喉结滚动，目光每2.8秒掠过挂钟。\\n\\n王野（低声，对技术员）：标记他看钟的节律。还有——我要微表情专家远程接口上线。\\n\\n1-3场景：银行内 日 内\\n\\n出场人物：王野、劫匪、人质\\n\\n△王野高举双手缓步前进，皮鞋碾过碎玻璃。阳光在碎片上跳动。\\n\\n王野（语调慵懒）：兄弟，你每2.8秒看一次钟。等什么？\\n\\n劫匪（枪口晃动）：闭嘴！再过来我开枪！\\n\\n△特写：挂钟秒针卡顿，壁面上有微弱震动回声。\\n\\n王野（忽然停步，语气一转）：你右手虎口厚茧不在食指，而在无名指根。那不是持枪茧，是搬货留下的。\\n\\n劫匪（呼吸紊乱）：别过来！\\n\\n△慢镜头：王野一个箭步扑倒劫匪！两人撞碎柜台玻璃。\\n\\n△特写：劫匪手指扣向腰间引爆器；王野手肘猛击其喉结，反手夺枪——“咔嗒”空膛声。\\n\\n王野（喘笑）：果然没子弹。\\n\\n△柜台后方突然烟雾爆起，警报声刺耳。人质尖叫。\\n\\n1-4场景：银行内 连续\\n\\n出场人物：王野、劫匪、人质、增援警员\\n\\n△烟雾中红点激光晃动。王野压低身形护住人质，肩头被碎玻璃划出血痕。\\n\\n王野（低声，对人质）：捂住耳朵，三秒后趴下。三、二——\\n\\n△他抄起灭火器朝天喷射，白雾覆盖监控死角。\\n\\n△劫匪趁乱翻窗逃窜。王野追出两步，忽然停住，弯腰捡起地上一枚滚落的戒指。\\n\\n特写：蛇形戒指，尾端刻着微小凹点序列。\\n\\n王野（自语，极轻）：摩尔斯……谁在给谁发信号？\\n\\n1-5场景：银行外 日 外\\n\\n出场人物：王野、林琛、媒体记者若干\\n\\n△拉线外，话筒蜂拥。林琛压住场面，目光扫到王野掌心的小物。\\n\\n林琛（低声）：又开始你的谜语人？\\n\\n王野（把戒指塞进口袋）：嫌犯不止一个，台上一个，台下一个。\\n\\n林琛：证据呢？\\n\\n王野（抬眼看向街对面）：证据在那辆车上。\\n\\n△特写：街对面一辆黑色轿车后视镜里，一只戴着相同蛇形戒指的手缓缓合上车窗。引擎声低沉远去。\\n\\n1-6场景：指挥车外 日 外\\n\\n出场人物：王野、林琛\\n\\n林琛（压低声音）：下次别赌空枪。\\n\\n王野（耸肩）：我赌的是人性——和你永远准备击毙的手。\\n\\n△手机震动，陌生短信弹出：\u201c想知道十四年前那场案子吗？来码头。\u201d\\n\\n王野（眯眼）：看来，有人也在等我。\\n\\n【本集结尾悬念】：真正的幕后玩家出现，蛇形戒指指向旧案，银行劫案只是序幕。",
    "wordCount": 680,
  "estimatedDuration": 2.0,
  "episodeSynopsisJsondocId": "episode-1-synopsis"
}

### 示例2：情感升温型（暧昧互动）
输出JSON格式：
{
  "episodeNumber": 4,
  "title": "咖啡馆的秘密",
    "scriptContent": "第4集\\n\\n4-1场景：安全屋 厨房 晨 内\\n\\n出场人物：王野、宋诺诺\\n\\n△百叶窗缝里渗进一束暖光，蒸汽在咖啡机喷口处颤动。案台上摆着打发器、温度计和两只预热的白瓷杯。\\n\\n△宋诺诺扎起马尾，指尖捏着拉花缸，凝视奶泡纹路。她鼻翼轻微扩张，呼吸细长。\\n\\n王野（从她身后探手去够顶柜的砂糖罐）：借过。\\n\\n宋诺诺（身体一僵，未回头）：退后三步。\\n\\n△王野停住，举着砂糖罐，笑意浅：\\n\\n王野：拿糖而已。（压低声贴近她耳侧）顺便说——耳尖泛红已经持续37秒。\\n\\n△奶泡缸轻微一颤，白色波纹溢出边沿。\\n\\n宋诺诺（面无表情，用纸巾擦去溢出的奶泡）：多动症晚期患者建议减少贴近他人。\\n\\n王野（绕到她正前方，伸指点了点杯壁）：温度过了63℃，奶泡太“紧”，再抖两下放松它。\\n\\n宋诺诺（抬眼，盯着他手）：谈判专家什么时候兼职咖啡师了？\\n\\n王野：读你表情时顺便学的。（目光掠过她的手腕）你刚才手抖，不是紧张，是肌肉记忆在找第七式的支点。\\n\\n宋诺诺（无波澜）：你偷看我练过海军格斗？\\n\\n王野（摊手）：你接杯子时拇指按压的角度会透露一切。\\n\\n△她忽然将杯沿的奶泡在他袖口轻轻一蹭。\\n\\n宋诺诺：你的衬衫材质亲肤度太差，建议挂个神经内科顺带皮肤科。\\n\\n王野（低笑，拇指擦过袖口）：医嘱接受。\\n\\n△咖啡机“嘶——”一声，蒸汽骤响，二人同时看向指针，默契一瞬对上视线，又各自移开。\\n\\n4-2场景：客厅 连续 内\\n\\n出场人物：王野、宋诺诺\\n\\n△案台上的对讲机闪烁。窗外远处救护车的回声还未散尽。\\n\\n王野（拿起对讲机，语气漫不经心）：林队，清点完了吗？（顿了顿）嗯，我这边安全。\\n\\n△挂断。王野伸手去端杯。宋诺诺先一步将杯子递到他手里。指尖相触。\\n\\n△特写：她的指尖冰凉，他的掌心温热。两人都未抽回。\\n\\n宋诺诺（淡声）：你昨晚受的伤……（目光落在他袖口下隐约的纱布印）\\n\\n王野（把杯子换成她那只，自己端起那杯更烫的）：不碍事。\\n\\n宋诺诺（盯着他腕脉，声音更轻）：再偏两毫米就伤到肺动脉。下次赌，别拿身体。\\n\\n王野（与她对视，收敛笑意）：那你别拿自己做诱饵。\\n\\n△短促的沉默。咖啡香在空气里旋转。\\n\\n王野（忽地把杯沿凑近她）：试试这个配比。\\n\\n△宋诺诺犹豫半秒，缓慢靠近杯沿。呼吸交叠。\\n\\n宋诺诺（啜一口，舌尖触到奶泡）：太甜。\\n\\n王野：那就苦一点。\\n\\n△他伸手从她手中接回杯子，食指却不慎擦过她下唇的奶泡。两人同时一顿。\\n\\n王野（低声）：失礼。\\n\\n宋诺诺（耳尖微红，微微别开脸）：建议王警官戴手套操作。\\n\\n4-3场景：安全屋 厨房 晨 内（连续）\\n\\n出场人物：王野、宋诺诺\\n\\n△桌面摊开警方照片与流程图。王野将一枚蛇形戒指放在咖啡杯旁。\\n\\n王野：这玩意儿昨晚掉的。尾部有点阵。\\n\\n△他用勺柄在纸上点出\u201c·· \u2014 ··\u201d的节律。\\n\\n宋诺诺（目光一凝）：摩尔斯。\\n\\n王野：我数了节拍，配得上你喜欢的4/4拍。\\n\\n宋诺诺：我更喜欢7/8。难猜一点。\\n\\n王野（挑眉）：挑战接受。\\n\\n△她忽然凑近，伸手拿过那枚戒指，指腹掠过冷硬的纹路。\\n\\n宋诺诺：你把它放我杯子旁，是想让我接手这条线，还是——（停顿）你想让我欠你一个人情？\\n\\n王野：第二个问题的答案，取决于你耳尖颜色的变化速度。\\n\\n△她瞥他一眼，拿起桌角的记号笔，刷地在白板上写下四个大字：\\n\\n宋诺诺（清晰）：不欠人情。\\n\\n△两人对视。气氛轻微地破了个孔。\\n\\n△门铃忽然“叮咚”。两人同时回头。\\n\\n王野（神色一敛，抬指示意安静）：访客识别码未登记。\\n\\n△他取下腰间手枪，轻触她手背，示意退到墙角。\\n\\n宋诺诺（压低声）：如果是宋家的人——\\n\\n王野：那这杯咖啡就当作道别酒。\\n\\n△门缝下投来一截阴影，门把手缓缓转动。\\n\\n【本集情感高潮】：暧昧与信任在厨房的咖啡香里升温，动作触点细密但未越界；门外未知访客打断，将暧昧推向未完成状态。\\n\\n【结尾悬念】：门外来者是谁？戒指的节律指向何处？\\n",
    "wordCount": 760,
    "estimatedDuration": 2.1,
  "episodeSynopsisJsondocId": "episode-4-synopsis"
}

### 示例3：悬念爆发型（反转揭秘）
输出JSON格式：
{
  "episodeNumber": 10,
  "title": "真相大白",
    "scriptContent": "第10集\\n\\n10-1场景：医院天台 夜 外\\n\\n出场人物：王野、宋诺诺\\n\\n△风掠过纱布，王野拆开肩头绷带。远处城市光点像冷掉的星。\\n\\n宋诺诺（按住他手腕）：最后一个问题，为什么用我生日当密码？\\n\\n王野（沉默片刻，望向远处）：那天不仅是你被绑架的日子……\\n\\n△手机震动打断，陌生短信：\u201c想知道谁杀了你父母吗？来码头。\u201d\\n\\n△两人对视，情绪骤冷。\\n\\n10-2场景：车内 夜 内（驶往废弃工厂）\\n\\n出场人物：王野、宋诺诺\\n\\n△雨点敲打挡风玻璃。雨刷来回。仪表盘微光映出两人侧脸。\\n\\n王野（低声）：短信从一次性小号发出，信号回落在滨江旧码头。\\n\\n宋诺诺（盯着手机碎屏上的字）：他们知道我父母的事——说明有人一直在看着我们。\\n\\n王野：我们也在看着他们。\\n\\n△他把一枚蛇形戒指递给她，尾端有点阵。\\n\\n王野：昨晚从那人手里夺下的。节律像摩尔斯。\\n\\n宋诺诺（用指甲轻点桌板，跟出节拍）：\u00b7\u00b7 \u2014 \u00b7\u00b7（眉心收紧）不是求救，是交易。\\n\\n10-3场景：废弃工厂外 晨 外（破晓）\\n\\n出场人物：王野、宋诺诺、黑衣人若干\\n\\n△天色将明未明，工厂屋顶残破，铁皮被风掀起\u201c咣当\u201d声。水泥地反着冷蓝。\\n\\n△一辆面包车停在阴影里，车门滑开，两个黑衣人押出一名被布袋套头的人质。\\n\\n黑衣人甲（扬声）：档案带了吗？\\n\\n王野（举起空空的资料袋）：先放人。\\n\\n黑衣人乙（冷笑）：规矩是我们定的。\\n\\n△宋诺诺余光扫到墙角红外对射，有节律闪烁。\\n\\n宋诺诺（压低声，对王野）：节律错了，两灯不同步，说明——\\n\\n王野（接上）：有人在另一端遥控。\\n\\n△他把资料袋抛向空中，袋内迸出无数空白纸。黑衣人条件反射抬头。\\n\\n△王野前冲锁喉；宋诺诺一个横踢，掀翻另一人手里的电击器。\\n\\n△混战间，墙边监控屏亮起，画面切入工厂内主控室，一个人影站在逆光中，指上蛇形戒指反光。\\n\\n10-4场景：主控室 内\\n\\n出场人物：王野、宋诺诺、神秘人\\n\\n△门被踢开。灰尘炸起。主控台上摆着档案袋、录音笔、一本发黄的《未成年人特殊监护协议》。\\n\\n神秘人（慢慢摘下头套，露出熟悉的侧影）：欢迎，谈判专家。\\n\\n△特写：他食指节上旧疤与戒指贴合成一条蛇形。\\n\\n王野（眯眼）：你盯了她多久？\\n\\n神秘人（摊手）：十四年。\\n\\n△屏幕切出旧录像：警校门口，少年王野在纪念碑前敬礼。另一帧，是某次密会的监控——一只手将\u201c监护协议\u201d推到镜头外。\\n\\n宋诺诺（抓起协议，目光一点点凝固）：\\n\\n监护人：王野（警校见习生）\\n被监护人：宋诺诺（绑架案唯一目击者）\\n特殊条款：需定期心理评估\\n\\n△她指尖发抖，纸角被捏出折痕。\\n\\n宋诺诺（喉间发紧）：所以这些年……\\n\\n王野（轻咳，眼神却不闪）：不是监视，是守护。\\n\\n神秘人（笑意更深）：守护？（抬下巴示意屏幕）那这些又怎么解释？\\n\\n△屏幕再切：某次交易的监控，王野与蛇戒者握手，拇指在对方脉搏上轻敲——\u201c· ·· ·\u201d。\\n\\n宋诺诺（瞳孔骤缩）：你在发信号。\\n\\n王野（看她）：我当年是卧底。那是暗号。\\n\\n神秘人（摊手）：说谎的人，心跳会错一拍。\\n\\n△瞬间安静。屏幕上的心电波形与现场两人的呼吸彼此错位。\\n\\n王野（忽然上前一步，按下录音笔）：那你也别说谎了。\\n\\n△录音回放：黑衣人甲的声音与神秘人的声线重合，细微破绽被放大。\\n\\n神秘人（脸色一变，猛地关屏）：玩够了。\\n\\n△他掀桌砸来，趁乱掏枪。王野侧身夺腕。枪响，灯管炸裂。\\n\\n10-5场景：废弃工厂外 晨 外（连续）\\n\\n出场人物：王野、宋诺诺、苏曼\\n\\n△警笛声逼近。黑衣人四散。苏曼快步冲来，挥舞文件袋。\\n\\n苏曼（提高音量）：供出来了！他不是唯一的上家！\\n\\n△她把文件袋塞到宋诺诺怀里。\\n\\n苏曼：王野是当年的卧底，这是全部记录。\\n\\n△照片特写：警校制服的王野在纪念碑前敬礼；另一页是监护协议签名栏：\u201c承诺人：王野\u201d。\\n\\n宋诺诺（呼吸一滞，眼圈泛红）：……\\n\\n王野（低声）：对不起，来得太晚。\\n\\n△忽然，宋诺诺手机震动。屏幕亮起未知号码：\u201c想知道谁杀了你父母吗？来码头。\u201d\\n\\n△镜头推近：王野脸色从温柔到凝重，手指在她肩上轻轻收紧。\\n\\n【本集反转与悬念】：卧底身份坐实，但真正的背后操盘者未现身；短信再度抛出\u201c父母案\u201d钩子，地点指向旧码头，危机升级。",
    "wordCount": 740,
    "estimatedDuration": 2.0,
  "episodeSynopsisJsondocId": "episode-10-synopsis"
}

## 关键写作技巧

  ### 镜头与声音
  - **△特写**：表情微动、手指习惯、物件纹理（刻字、点阵、污渍走向）。
  - **节奏镜头**：推进用中近景，爆点用特写+慢镜；转场用对焦/遮挡，竖屏避免空镜。
  - **声音线索**：SFX/BGM用于情绪预告与信息差（心跳错拍、短信入场、雨刷节律）。

  ### 对白与潜台词
  - **职业驱动**：专业术语少而准，用于“看见别人看不见”的细节。
  - **潜台词**：同一句台词服务两重目的（推进案情+推进关系）。
  - **金句锚点**：每段落预留一句可做标题/弹幕复读的高能台词。

  ### 悬念与反转
  - **信息差设计**：物件（戒指/协议/照片）、生理信号（脉搏/瞳孔）、节律（摩尔斯/呼吸）持久呼应。
  - **反转验证**：反转后立刻给出动作或证据验证，避免空洞“口头反转”。
  - **未完成机制**：关键告白/答案在外力打断时戛止，保留强钩子。

  ### 可拍性与剪辑友好
  - **落地道具**：一到两件核心道具反复利用（杯、戒指、钥匙、文件），避免昂贵场面。
  - **切片点**：每段落以动作或金句收尾，方便竖屏二改与二次分发。
  - **动作触点**：手腕/下颌/衣领/杯沿等触点设计，既推进关系又提供视觉抓手。

  ### 输出格式要求
  生成的内容必须严格按照以上JSON格式，包含：
- episodeNumber: 集数
- title: 集标题  
  - scriptContent: 完整剧本内容（场景描述+人物对话+动作指导）。
    - 必须含有至少一次标注的回忆/插叙/闪回段落（例如：回忆-咖啡馆/插叙-旧码头/闪回-案发夜）。
    - 在首个场景的前20秒内明确时间与地点锚点；在前60秒内给出三角关系锚点。
  - wordCount: 字数统计（目标700-900，过短需自动补足细节，过长压缩说明性台词）
- estimatedDuration: 预估时长（分钟）
- episodeSynopsisJsondocId: 对应的分集大纲ID

### 重要：确保剧情连贯性
- 与前面已生成的剧本保持剧情连贯
- 承接前集的结尾悬念（如果存在）
- 为后续集数埋下伏笔
- 在整体故事弧线中找准当前集的定位

## 生成参数
%%params%%`,
  outputFormat: 'json',
  variables: ['jsondocs', 'params']
}; 