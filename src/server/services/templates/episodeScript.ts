import type { LLMTemplate } from '../../../common/llm/types';

export const episodeScriptTemplate: LLMTemplate = {
  id: '单集剧本_generation',
  name: 'Episode Script Generation',
  promptTemplate: `你是专业的中国短剧编剧，专门为抖音、快手、小红书等平台创作2分钟短剧剧本。

## 参考资料

以下是生成剧本的参考资料：

**主要内容来源：**
- **[jsondoc] 分集大纲** - 这是你创作剧本的主要依据，包含开场钩子、主要剧情、情感高潮和结尾悬念
- **[jsondoc] 剧本设定** - 提供角色设定、世界观、商业定位等框架信息
- **[jsondoc] 前集剧本** - 提供前面已生成的剧本，确保连贯性和一致性（如果存在）

%%jsondocs%%

## 创作要求

### 2分钟短剧特色
- **快节奏叙事**：每分钟都要有明确的剧情推进和情绪爆点
- **垂直视频优化**：考虑手机竖屏观看体验，对话和表演要紧凑
- **爽点密集**：符合移动端用户碎片化观看习惯，持续制造爽点
- **去脸谱化**：避免刻板印象的人物和剧情，追求真实和新颖

### 剧本格式要求
- 采用标准剧本格式
- 场景描述简洁明了
- 对话自然流畅，符合人物性格
- 动作指导清晰可执行
- 控制在适合2分钟播放的字数范围内

### 结构要求
1. **开场钩子** (0-15秒) - 立即抓住观众注意力
2. **主要剧情** (15秒-1分30秒) - 核心故事发展
3. **情感高潮** (1分30秒-1分50秒) - 情感冲突达到顶点
4. **结尾悬念** (1分50秒-2分钟) - 强烈钩子引导下集

## 格式示例

以下是标准的剧本输出格式示例：

### 示例1：开场钩子型（紧张悬疑）
输出JSON格式：
{
  "episodeNumber": 1,
  "title": "银行劫案真相",
  "scriptContent": \`第1集

1-1场景：银行外 日 外

出场人物：王野（32岁，谈判专家）、林琛（35岁，特警队长）

△特写：银行监控屏幕闪烁，劫匪持枪抵住人质太阳穴。女职员睫毛颤动，泪痕反光。

劫匪（画外音，声线发颤）：我要见谈判专家！现在！

△王野推开车门，扯松领带。

王野：啧，又是临时工水平。

林琛（按住王野肩膀）：这次别玩你那套，直接击毙！

王野（盯着监控，低声）：等等。人质瞳孔持续缩小，呼吸频率不匹配……劫匪在撒谎。

——

1-2场景：指挥车内 日 内

出场人物：上同，通话连线：银行大厅劫匪（男，口音不明）

△镜头：热成像显示大厅内共有三处热源，两处移动不规律。

林琛：两条通道、四个狙击位，一声令下——

王野（打断）：谁先开枪，谁负责收尸通知。给我三分钟。

△对讲开启，静电噪音。

王野（对讲，平稳）：兄弟，我到了。你开口前，先听我问三个问题。

劫匪（警觉）：少废话！把出入口的警察撤走！

王野：第一，人质右手在你枪口下微颤，说明她左撇子。第二，你说你是第一次持枪，但你的手臂肌肉有旧伤位移。第三，你口音不在本地，北区？

劫匪（沉默两秒，压低）：你到底是谁？

王野：能救你和她的人。

——

1-3场景：银行大厅 日 内

出场人物：女职员（人质，24岁）、劫匪（男，30岁左右，戴口罩）

△广角：地面散落现金包，安保门半开，警报灯断续闪烁。

△特写：女职员指尖有淡淡蓝色墨痕，袖口内侧粘着纸屑。

王野（对讲，低声给队伍）：人质是柜台核对员，袖口纸屑是点钞纸，说明她在转移赃款——不是，应该是被逼转移。

林琛（压着怒气）：你是在替劫匪找理由？

王野：我在替我们找突破口。

△慢镜：劫匪额角渗汗，频繁回头看二楼走道。

王野（对讲，转向劫匪）：你不在等钱，你在等“他”。楼上有人指挥你？

劫匪（情绪炸裂）：闭嘴！再说我就——

女职员（突然）：别开枪！他不是坏人！

——

1-4场景：屋顶通风井 日 内

出场人物：未知黑影（仅脚步与呼吸声）

△音效：轻微金属碰撞。

△镜头切换：通风口的灰层被人指腹划出一道弧线，地方很干净，表明有人近期来过。

王野（自语）：上面还真有人。

林琛（望远镜观察屋顶）：我看不到影子。

王野：他不想被看到。他在等我们犯错。

——

1-5场景：银行大厅 日 内（对峙）

△特写：女职员唇色发白，眼角细微向左。

王野（柔声，对劫匪）：她在看你的左手。你颤得厉害。把枪移到桌上，枪口朝外，我们谈三句话。

劫匪：你不懂——

王野：第一句，我知道你不是要钱。第二句，你是被威胁的人。第三句，楼上的人才是真正的劫匪。

△劫匪握枪更紧，喉结滚动。

王野（继续，不给思考空档）：你右臂旧伤搬运不了重物，进门后你只选择了最近的人质——说明你临时被推上台。现在，放下它，让她走。

女职员（低声，对劫匪）：求你了。

△一瞬静默。

劫匪（嘶哑）：我……我只有一个条件。把我妹妹放了。

王野（眼神一凝）：妹妹在楼上？

劫匪：他们抓了她。让我照他们说的做。

——

1-6场景：监控室走廊 日 内（情感高潮）

出场人物：王野、林琛、小队员甲

△快切：战术地图、通风井示意、二楼走廊热源点快速标注。

林琛：给我一个不误伤的方案。

王野：用“信息差”。

△王野对着走廊摄像头，故意偏头露出耳麦。

王野（对讲，刻意让楼上能听到）：狙击位一号准备清除楼上指挥。

小队员甲（疑惑看向林琛）：我们有一号吗？

林琛（会意，压手示意别说）：现在有了。

△楼上通风井里传来急促脚步声向后撤。

王野（低声）：钓出真正的鱼。

——

1-7场景：二楼消防门 日 内（反转与悬念）

出场人物：黑衣人（真正主谋，戴棒球帽）、小队员乙

△黑衣人推门而出，迎面撞上小队员乙设置的反光板，短暂失明。

小队员乙（上前制服）：别动！

黑衣人（冷笑，挣脱，扔出手机）：迟了。

△一条短信已发送：“B计划，三十秒。”

——

1-8场景：银行大厅 日 内（结尾悬念）

△警报突然转为连续长鸣。天花板喷淋系统启动，水雾弥漫。

女职员（惊叫）：有烟！

△王野抬头，水珠在他睫毛上颤动。

王野（低声极快）：不是烟，是催泪！所有人低头、用袖口遮鼻！

△他冲进水雾中，抓住劫匪手腕，将枪拍落，反手把人质护到身后。

林琛（对讲怒吼）：谁动了喷淋？

△楼上通风井内，一只细线被缓缓收回，连接着喷淋阀门装置。

王野（盯向摄像头，冷下去）：幕后的人，还在看我们。

△画面定格在监控屏：一个被马赛克遮住的脸，缓慢靠近镜头。

【黑屏大字】：他知道你的名字。
\`,
  "wordCount": 760,
  "estimatedDuration": 2.2,
  "episodeSynopsisJsondocId": "episode-1-synopsis"
}

### 示例2：情感升温型（暧昧互动）
输出JSON格式：
{
  "episodeNumber": 4,
  "title": "咖啡馆的秘密",
  "scriptContent": \`第4集

4-1场景：安全屋 晨 内

出场人物：王野、宋诺诺

△晨光透过百叶窗，咖啡机咕噜声。蒸汽升腾像薄雾。

△宋诺诺专注盯着拿铁拉花，指尖轻敲杯沿；王野从背后贴近，越过她肩膀去够顶柜糖罐。

宋诺诺（身体僵直，低声）：退后三步。

王野（举着糖罐，无辜）：拿糖而已。（忽然靠近耳侧）顺便说，你耳尖泛红持续37秒。

△她手一抖，奶泡溢出。王野接住杯子，手指擦过她指背。

宋诺诺（抽回手，故意将咖啡渍蹭上他袖口）：建议王警官挂神经内科。（抬眸）你的肌肉记忆来自海军格斗训练第7式。

王野（慢条斯理舔掉虎口奶泡）：建议宋专家复查微表情教材。（撑住料理台将她圈住）第214页写明，咬唇的撒谎概率是87%。

宋诺诺（别开脸，嘴角却微扬0.3秒）：统计学不适用于个体样本。

——

4-2场景：电梯 日 内（暧昧升级）

出场人物：王野、宋诺诺、前台小姐姐（过场）

△电梯门合拢，镜面里两人并肩的倒影彼此靠近又弹开。

王野（瞟她手腕）：脉搏加快到每分钟112。

宋诺诺（不抬眼）：你站太近，侵犯个人空间。

王野（往后半步，露出笑）：现在呢？

宋诺诺（看他胸膛起伏）：你呼吸频率乱了。

△叮——电梯停。门开又合，两人一动不动。对讲机里传来前台嬉笑：楼上空调坏了，别靠太近会更热哦。

——

4-3场景：宋氏集团会议室 日 内（职业互撩）

出场人物：王野、宋诺诺、对手代表、助理

△对手代表拍桌：“若不让出20%股权，立刻终止！”

宋诺诺（翻文件，冷声）：你们现金流表第三页，小数点后两位复制错了。

△王野懒散转笔，忽然压低声线：“李总，鼻翼扩张幅度变大三倍，是慌了？”

对手代表脸色一变。

王野（侧头对宋诺诺，压低）：评分，刚才我的“施压战术”。

宋诺诺（淡淡）：59分，不及格。

王野（挑眉）：那你为什么不敢看我眼睛？

△她抬眼对上他，反客为主：“王警官，右眉抽动0.2秒，虚张声势的典型。”

△对手代表心态崩，签字。助理憋笑，会议结束。

——

4-4场景：露台 黄昏 外（情感高潮）

出场人物：王野、宋诺诺

△晚霞映在玻璃幕墙，风吹起她鬓发。

王野（脱外套搭她肩）：白天风大。

宋诺诺（握住外套边角，盯他手腕旧伤）：这不是“风大”的问题。（忽地拽过他手）伤口深度约3厘米，再偏2毫米就伤到肺动脉。

王野（失笑）：专家同志，今天聊伤口，不聊心口？

△她将他的手按到自己脉搏处：数数，现在谁心跳快？

王野（喉结滚动，压低）：一百二十三。

宋诺诺（移开他的手，耳尖发红）：统计学不适用个体样本。

△两人靠近到呼吸相触。

王野（忽然收敛玩笑，认真）：诺诺，别再一个人扛了。

宋诺诺（停顿，眼神躲闪）：我没有——

王野（轻轻打断）：撒谎时你会掐掌心。

△她低头，掌心的月牙印清晰。

——

4-5场景：街角咖啡馆 夜 内（结尾悬念）

出场人物：王野、宋诺诺、店员（过场）

△窗外霓虹在咖啡杯壁上跳动。店里的黑胶唱片轻哼。

王野（把店员递来的糖包推到她面前）：一包白糖，两包黑糖，第三包留着下次吵架时赔罪。

宋诺诺（抿笑，正要回怼）——

△她手机震动，屏幕亮起：未知号码发来一段视频预览缩略图。

△特写：两人电梯里并肩的倒影，被放大、拉近、加红心贴纸。

王野（眉头一挑，声音沉下来）：谁在盯着我们？

△视频自动播放一秒，画面突然卡死，屏幕上跳出一句话：你们的“约会”，很好看。

△镜头拉远，窗外对面楼的某个黑暗窗格里，一点红光一闪即灭。

【黑屏大字】：有人比你更懂你的心跳。
\`,
  "wordCount": 820,
  "estimatedDuration": 2.3,
  "episodeSynopsisJsondocId": "episode-4-synopsis"
}

### 示例3：悬念爆发型（反转揭秘）
输出JSON格式：
{
  "episodeNumber": 10,
  "title": "真相大白",
  "scriptContent": \`第10集

10-1场景：旧码头 夜 外（开场钩子）

出场人物：王野、宋诺诺

△冷风裹着海腥味。废弃吊机在远处嘎吱作响。

△手机屏幕特写：未知号码短信——“想知道谁杀了你父母吗？来码头。”

王野（压低嗓音）：我先进去，五分钟。

宋诺诺（握住他衣袖，目光坚定）：一起。

△两人并肩进入昏黄灯带的仓库。

——

10-2场景：仓库中控室 夜 内（主要剧情：反转铺垫）

出场人物：王野、宋诺诺、黑衣人（头目，戴蛇形戒指）

△监控墙亮起，画面轮番切换过去几天两人同框的监控：电梯并肩、露台靠近、咖啡馆对望。

黑衣人（慢拍手）：谈判专家，带着你的测谎师来了。

△王野将文件袋放在桌上，握手时拇指在对方脉搏轻敲三下（摩尔斯：等时机）。

宋诺诺（盯着戒指）：那枚蛇形戒指……与十四年前证物一致。

黑衣人（挑眉）：你们的“约会”真好看。她每次心动都写在脸上。

宋诺诺（冷笑）：你们给我下的药，现在撑不住了吧？（盯他鼻翼）扩张频率变快，怕了。

——

10-3场景：二层走道 夜 内（情感高潮：真相揭面）

出场人物：苏曼（闺蜜/卧底）、王野、宋诺诺

△玻璃被打碎，防爆绳从天而降。苏曼翻窗而入，甩出文件袋。

苏曼（利落）：抱歉迟到，国际刑警苏曼，来交作业。

△文件散开：照片、协议、账本。

△照片特写：少年王野穿警校制服，在“7·3绑架案”纪念碑前敬礼。

△档案封面：《未成年人特殊监护协议》。

宋诺诺（颤声念）：监护人：王野（警校见习生）/ 被监护人：宋诺诺（唯一目击者）。

△她指尖发抖，纸页轻颤。

宋诺诺（抬眼，红着眼眶）：所以这些年……你一直……

王野（收敛玩笑，郑重）：不是监视，是守护。

△他将她的手带到自己心口。

王野（低声）：从你七岁那天起，我就欠你一个真相。

——

10-4场景：仓库底层 夜 内（反转爆发）

出场人物：黑衣人、王野、宋诺诺、苏曼

△警笛远处回响。黑衣人忽然掏出遥控器，按下。

△红灯闪烁，铁门“咣当”落锁。喷淋系统开启，水雾与催泪混杂。

王野（厉喝）：低头，遮鼻！

△他把宋诺诺护在怀里，反手抄起灭火器砸向控制箱。

苏曼（边咳边笑）：王警官，浪漫的雨中告白改成化学烟雾也行？

△黑衣人趁乱欲逃，被王野压在地上。

王野（冷声，掰开他手）：把你“老板”的名字说出来。

黑衣人（眼珠血红，嘶笑）：你们以为今晚是终点？哈哈——只是开始。

△他露出手腕内侧的烫痕：一枚新月形烙印。

宋诺诺（骤然一震）：新月会……

——

10-5场景：仓库外 拂晓 外（结尾悬念：更大黑手）

出场人物：王野、宋诺诺、苏曼、未知来电者（仅声音）

△天光鱼肚白。救护车灯光在海面投出红蓝色碎片。

△苏曼递来最后一份资料。

苏曼：账本坐实宋氏与境外洗钱链路，但主账本缺一页——被人撕走了。

△王野手机响起，“未知号码”。

未知来电者（男声经过变调，极慢）：小野哥哥，好久不见。

△宋诺诺身形一僵，缓缓抬头。

未知来电者：想知道你父亲真正的死因吗？把监护协议带上，今夜码头灯塔见。只限你一个人。

△嘟——通话被切断。海风骤紧。

王野（握紧手机，指节发白）：他知道我们的全部。

△镜头推向远处灯塔，一盏红灯忽明忽暗。

【黑屏大字】：真相只是序章。
\`,
  "wordCount": 810,
  "estimatedDuration": 2.4,
  "episodeSynopsisJsondocId": "episode-10-synopsis"
}

## 关键写作技巧

### 镜头语言运用
- **△特写**：突出关键道具、表情、动作
- **画外音**：增加神秘感和紧张氛围  
- **慢镜头**：强调重要情感瞬间
- **镜头切换**：快速推进剧情节奏

### 对话特色
- **职业特色融入**：利用角色专业技能制造对话张力
- **潜台词丰富**：表面对话下暗藏真实意图
- **节奏感强**：短促有力，适合快节奏剧情

### 悬念设置
- **信息差**：角色知道观众不知道的信息
- **时间压迫**：倒计时、追赶等紧迫情境
- **身份反转**：颠覆观众对角色的认知
- **未完成告白**：在关键时刻被打断

### 输出格式要求
生成的内容必须严格按照以上JSON格式，包含：
- episodeNumber: 集数
- title: 集标题  
- scriptContent: 完整剧本内容（场景描述+人物对话+动作指导）
- wordCount: 字数统计
- estimatedDuration: 预估时长（分钟）
- episodeSynopsisJsondocId: 对应的分集大纲ID

### 重要：确保剧情连贯性
- 与前面已生成的剧本保持剧情连贯
- 承接前集的结尾悬念（如果存在）
- 为后续集数埋下伏笔
- 在整体故事弧线中找准当前集的定位

## 生成参数
%%params%%`,
  outputFormat: 'json',
  variables: ['jsondocs', 'params']
}; 